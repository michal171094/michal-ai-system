<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>הוספת משימות קיימות - מיכל AI</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #2c3e50; text-align: center; }
        .section { margin-bottom: 30px; padding: 20px; border: 2px solid #e74c3c; border-radius: 8px; background: #fff5f5; }
        .section h2 { color: #e74c3c; margin-top: 0; }
        .task { margin: 10px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; background: #f9f9f9; position: relative; }
        .task.selected { border: 2px solid #27ae60; background: #f0fff0; }
        .task h3 { margin: 0 0 10px 0; color: #2980b9; }
        .task p { margin: 5px 0; }
        .task input[type="checkbox"] { position: absolute; top: 10px; left: 10px; transform: scale(1.5); }
        .task-content { margin-right: 40px; }
        .task textarea { width: 100%; height: 60px; margin-top: 10px; padding: 5px; border-radius: 3px; border: 1px solid #ddd; }
        .priority { font-weight: bold; }
        .high { color: #e74c3c; }
        .medium { color: #f39c12; }
        .low { color: #27ae60; }
        .custom-task { margin: 20px 0; padding: 20px; border: 2px solid #3498db; border-radius: 8px; background: #f8f9fa; }
        .form-group { margin: 10px 0; }
        .form-group label { display: block; font-weight: bold; margin-bottom: 5px; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        .form-group textarea { height: 80px; }
        button { padding: 15px 30px; font-size: 16px; border: none; border-radius: 5px; cursor: pointer; margin: 10px; }
        .btn-primary { background: #3498db; color: white; }
        .btn-success { background: #27ae60; color: white; }
        .btn-danger { background: #e74c3c; color: white; }
        #status { margin-top: 20px; padding: 15px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .loading { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🎯 הוספת המשימות הקיימות של מיכל</h1>
        
        <div class="section">
            <h2>📚 משימות אקדמיות ועבודות</h2>
            <div class="task" data-task-id="0">
                <input type="checkbox" checked onchange="toggleTask(this, 0)">
                <div class="task-content">
                    <h3>מרג'ורי - תרגום ואפוסטיל</h3>
                    <p><strong>תיאור:</strong> טיפול בתרגום, בדיקת מסמכים, אפוסטיל, בירור התאמה לגרמניה</p>
                    <p><strong>לקוח:</strong> מרג'ורי תרגום</p>
                    <p><strong>סטטוס:</strong> מהלך מתגלגל - השלמות מול הלקוחה</p>
                    <p class="priority medium">📅 עדיפות: בינונית</p>
                    <textarea placeholder="הוסף הערות או שנה פרטים..."></textarea>
                </div>
            </div>
            
            <div class="task" data-task-id="1">
                <input type="checkbox" checked onchange="toggleTask(this, 1)">
                <div class="task-content">
                    <h3>כרמית - סמינריון עם הוספת מאמרים</h3>
                    <p><strong>תיאור:</strong> הוספת מאמרים לסמינריון (צריך 8 מאמרים, להוסיף עוד 3), הפקת מסמך</p>
                    <p><strong>לקוח:</strong> כרמית סמינר</p>
                    <p><strong>דד-ליין:</strong> עד מחר בערב/טרם הגשה</p>
                    <p class="priority high">🔥 עדיפות: גבוהה</p>
                    <textarea placeholder="הוסף הערות או שנה פרטים..."></textarea>
                </div>
            </div>
            
            <div class="task" data-task-id="2">
                <input type="checkbox" checked onchange="toggleTask(this, 2)">
                <div class="task-content">
                    <h3>עבודה סמינריונית קבוצתית</h3>
                    <p><strong>תיאור:</strong> סיום עבודה, מתן תמיכה אקדמית, פתרונות למשבר בין חברות</p>
                    <p><strong>לקוח:</strong> קבוצת סמינריון</p>
                    <p><strong>סטטוס:</strong> אין דדליין ספציפי</p>
                    <p class="priority low">⚡ עדיפות: נמוכה</p>
                    <textarea placeholder="הוסף הערות או שנה פרטים..."></textarea>
                </div>
            </div>
            
            <div class="task" data-task-id="3">
                <input type="checkbox" checked onchange="toggleTask(this, 3)">
                <div class="task-content">
                    <h3>ישראל - סמינר וועדה</h3>
                    <p><strong>תיאור:</strong> שליחת טיוטות, אישור ועדה, טיפול במסמכים, התקדמות לפי הערות</p>
                    <p><strong>לקוח:</strong> ישראל סמינר</p>
                    <p><strong>התראה:</strong> "לא נשאר הרבה זמן.."</p>
                    <p class="priority high">🔥 עדיפות: גבוהה</p>
                    <textarea placeholder="הוסף הערות או שנה פרטים..."></textarea>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>💰 חובות וגבייה</h2>
            <div class="task" data-task-id="4">
                <input type="checkbox" checked onchange="toggleTask(this, 4)">
                <div class="task-content">
                    <h3>coeo Inkasso - Ostrom GmbH</h3>
                    <p><strong>מספר תיק:</strong> 1660002492</p>
                    <p><strong>סכום:</strong> ~455€</p>
                    <p><strong>סטטוס:</strong> בהתנגדות פעילה / בשלבי טיפול</p>
                    <p class="priority medium">⚖️ עדיפות: בינונית</p>
                    <textarea placeholder="הוסף הערות או שנה פרטים..."></textarea>
                </div>
            </div>
            
            <div class="task" data-task-id="5">
                <input type="checkbox" checked onchange="toggleTask(this, 5)">
                <div class="task-content">
                    <h3>PAIR Finance - Free2Move</h3>
                    <p><strong>מספר תיק:</strong> 162857501033</p>
                    <p><strong>סכום:</strong> ~45-69€</p>
                    <p><strong>סטטוס:</strong> לא שולם, ממשיכים בהליכי גביה</p>
                    <p class="priority medium">⚖️ עדיפות: בינונית</p>
                    <textarea placeholder="הוסף הערות או שנה פרטים..."></textarea>
                </div>
            </div>
            
            <div class="task" data-task-id="6">
                <input type="checkbox" checked onchange="toggleTask(this, 6)">
                <div class="task-content">
                    <h3>PAIR Finance - Novum Bank Cashper</h3>
                    <p><strong>מספר תיק:</strong> 168775195683</p>
                    <p><strong>סכום:</strong> 208.60€</p>
                    <p><strong>סטטוס:</strong> לא שולם, נשלחו הצעות פשרה</p>
                    <p class="priority medium">⚖️ עדיפות: בינונית</p>
                    <textarea placeholder="הוסף הערות או שנה פרטים..."></textarea>
                </div>
            </div>
            
            <div class="task" data-task-id="7">
                <input type="checkbox" checked onchange="toggleTask(this, 7)">
                <div class="task-content">
                    <h3>רשות האכיפה והגבייה - משרד הביטחון</h3>
                    <p><strong>מספר תיק:</strong> 774243-03-25</p>
                    <p><strong>סכום:</strong> ₪7,355.17</p>
                    <p><strong>סטטוס:</strong> תיק טרום חוב/התראה/פתוח</p>
                    <p class="priority high">🔥 עדיפות: גבוהה</p>
                    <textarea placeholder="הוסף הערות או שנה פרטים..."></textarea>
                </div>
            </div>
            
            <div class="task" data-task-id="8">
                <input type="checkbox" checked onchange="toggleTask(this, 8)">
                <div class="task-content">
                    <h3>מנורה מבטחים - חובות ביטוח</h3>
                    <p><strong>סכומים:</strong> ₪330.43, ₪326.02, ₪85.21</p>
                    <p><strong>סטטוס:</strong> פתוח/דרישת תשלום עבור מספר פוליסות ביטוח</p>
                    <p class="priority medium">⚖️ עדיפות: בינונית</p>
                    <textarea placeholder="הוסף הערות או שנה פרטים..."></textarea>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>🏢 בירוקרטיה ומוסדות</h2>
            <div class="task" data-task-id="9">
                <input type="checkbox" checked onchange="toggleTask(this, 9)">
                <div class="task-content">
                    <h3>TK - קופת חולים גרמניה</h3>
                    <p><strong>מספר תיק:</strong> B268202260</p>
                    <p><strong>סטטוס:</strong> בתהליך בירור בקשה/התנגדות</p>
                    <p class="priority medium">📋 עדיפות: בינונית</p>
                    <textarea placeholder="הוסף הערות או שנה פרטים..."></textarea>
                </div>
            </div>
            
            <div class="task" data-task-id="10">
                <input type="checkbox" checked onchange="toggleTask(this, 10)">
                <div class="task-content">
                    <h3>ביטוח לאומי - הגשת מסמכים</h3>
                    <p><strong>מספר תיק:</strong> 897777</p>
                    <p><strong>סטטוס:</strong> הגשת מסמכים/בתהליכי בדיקה</p>
                    <p class="priority medium">📋 עדיפות: בינונית</p>
                    <textarea placeholder="הוסף הערות או שנה פרטים..."></textarea>
                </div>
            </div>
            
            <div class="task" data-task-id="11">
                <input type="checkbox" checked onchange="toggleTask(this, 11)">
                <div class="task-content">
                    <h3>רשות האכיפה והגבייה - קנסות</h3>
                    <p><strong>מספר תיק:</strong> 164025</p>
                    <p><strong>סטטוס:</strong> טיפול בפניות/בחינה</p>
                    <p class="priority medium">📋 עדיפות: בינונית</p>
                    <textarea placeholder="הוסף הערות או שנה פרטים..."></textarea>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>➕ הוסף משימות חדשות</h2>
            <div class="custom-task">
                <h3>📝 צור משימה חדשה</h3>
                <div class="form-group">
                    <label>כותרת המשימה:</label>
                    <input type="text" id="newTaskTitle" placeholder="לדוגמה: מענה לעורך הדין של...">
                </div>
                <div class="form-group">
                    <label>תיאור מפורט:</label>
                    <textarea id="newTaskDescription" placeholder="תאר במפורט מה צריך לעשות..."></textarea>
                </div>
                <div class="form-group">
                    <label>סוג משימה:</label>
                    <select id="newTaskType">
                        <option value="academic">📚 אקדמי</option>
                        <option value="debts">💰 חובות</option>
                        <option value="bureaucracy">🏢 בירוקרטיה</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>עדיפות:</label>
                    <select id="newTaskPriority">
                        <option value="high">🔥 גבוהה</option>
                        <option value="medium">📅 בינונית</option>
                        <option value="low">⚡ נמוכה</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>דד-ליין (אופציונלי):</label>
                    <input type="text" id="newTaskDeadline" placeholder="לדוגמה: עד סוף השבוע">
                </div>
                <div class="form-group">
                    <label>הערות נוספות:</label>
                    <textarea id="newTaskNotes" placeholder="כל מידע נוסף שחשוב..."></textarea>
                </div>
                <button class="btn-primary" onclick="addCustomTask()">➕ הוסף משימה זו</button>
                <button class="btn-danger" onclick="clearCustomTask()">🗑️ נקה טופס</button>
            </div>
            
            <div id="customTasksList"></div>
        </div>

        <div style="text-align: center; margin-top: 30px;">
            <button class="btn-primary" onclick="selectAll()">☑️ בחר הכל</button>
            <button class="btn-primary" onclick="deselectAll()">☐ בטל הכל</button>
            <button class="btn-success" onclick="addSelectedTasks()">✅ הוסף משימות נבחרות</button>
            <button class="btn-danger" onclick="clearAll()">🗑️ נקה הכל</button>
        </div>

        <div id="status"></div>
    </div>

    <script>
        const tasks = [
            // Academic/Work tasks
            { 
                title: "מרג'ורי - תרגום ואפוסטיל",
                description: "טיפול בתרגום, בדיקת מסמכים, אפוסטיל, בירור התאמה לגרמניה",
                type: "academic",
                priority: "medium",
                client: "מרג'ורי תרגום",
                status: "in_progress",
                notes: "מהלך מתגלגל - השלמות מול הלקוחה"
            },
            { 
                title: "כרמית - סמינריון עם הוספת מאמרים",
                description: "הוספת מאמרים לסמינריון (צריך 8 מאמרים, להוסיף עוד 3), הפקת מסמך",
                type: "academic",
                priority: "high",
                client: "כרמית סמינר",
                status: "urgent",
                deadline: "מחר בערב",
                notes: "טרם הגשה - דחוף!"
            },
            { 
                title: "עבודה סמינריונית קבוצתית",
                description: "סיום עבודה, מתן תמיכה אקדמית, פתרונות למשבר בין חברות",
                type: "academic",
                priority: "low",
                client: "קבוצת סמינריון",
                status: "pending",
                notes: "אין דדליין ספציפי"
            },
            { 
                title: "ישראל - סמינר וועדה",
                description: "שליחת טיוטות, אישור ועדה, טיפול במסמכים, התקדמות לפי הערות",
                type: "academic",
                priority: "high",
                client: "ישראל סמינר",
                status: "urgent",
                notes: "לא נשאר הרבה זמן.."
            },
            
            // Debt tasks
            { 
                title: "coeo Inkasso - Ostrom GmbH",
                description: "התנגדות לחוב חברת חשמל גרמנית",
                type: "debts",
                priority: "medium",
                amount: "455€",
                caseNumber: "1660002492",
                status: "in_dispute",
                notes: "בהתנגדות פעילה / בשלבי טיפול"
            },
            { 
                title: "PAIR Finance - Free2Move",
                description: "חוב שכירות רכב",
                type: "debts",
                priority: "medium",
                amount: "45-69€",
                caseNumber: "162857501033",
                status: "unpaid",
                notes: "לא שולם, ממשיכים בהליכי גביה"
            },
            { 
                title: "PAIR Finance - Novum Bank Cashper",
                description: "חוב בנק",
                type: "debts",
                priority: "medium",
                amount: "208.60€",
                caseNumber: "168775195683",
                status: "settlement_offered",
                notes: "לא שולם, נשלחו הצעות פשרה"
            },
            { 
                title: "רשות האכיפה והגבייה - משרד הביטחון",
                description: "חוב למשרד הביטחון דרך הוצאה לפועל",
                type: "debts",
                priority: "high",
                amount: "₪7,355.17",
                caseNumber: "774243-03-25",
                status: "pending",
                notes: "תיק טרום חוב/התראה/פתוח"
            },
            { 
                title: "מנורה מבטחים - חובות ביטוח",
                description: "חובות על מספר פוליסות ביטוח",
                type: "debts",
                priority: "medium",
                amount: "₪330.43 + ₪326.02 + ₪85.21",
                status: "pending",
                notes: "פתוח/דרישת תשלום עבור מספר פוליסות ביטוח"
            },
            
            // Bureaucracy tasks
            { 
                title: "TK - קופת חולים גרמניה",
                description: "בירור בקשה/התנגדות בקופת חולים",
                type: "bureaucracy",
                priority: "medium",
                caseNumber: "B268202260",
                status: "pending",
                notes: "בתהליך בירור בקשה/התנגדות"
            },
            { 
                title: "ביטוח לאומי - הגשת מסמכים",
                description: "הגשת מסמכים וטיפול בתיק",
                type: "bureaucracy",
                priority: "medium",
                caseNumber: "897777",
                status: "pending",
                notes: "הגשת מסמכים/בתהליכי בדיקה"
            },
            { 
                title: "רשות האכיפה והגבייה - קנסות",
                description: "טיפול בקנסות ופניות",
                type: "bureaucracy",
                priority: "medium",
                caseNumber: "164025",
                status: "pending",
                notes: "טיפול בפניות/בחינה"
            }
        ];

        let customTasks = [];
        let selectedTasks = new Set();

        function toggleTask(checkbox, taskId) {
            const taskDiv = checkbox.closest('.task');
            if (checkbox.checked) {
                selectedTasks.add(taskId);
                taskDiv.classList.add('selected');
            } else {
                selectedTasks.delete(taskId);
                taskDiv.classList.remove('selected');
            }
            updateSelectedCount();
        }

        function selectAll() {
            document.querySelectorAll('.task input[type="checkbox"]').forEach((cb, index) => {
                cb.checked = true;
                selectedTasks.add(index);
                cb.closest('.task').classList.add('selected');
            });
            updateSelectedCount();
        }

        function deselectAll() {
            document.querySelectorAll('.task input[type="checkbox"]').forEach((cb, index) => {
                cb.checked = false;
                selectedTasks.delete(index);
                cb.closest('.task').classList.remove('selected');
            });
            updateSelectedCount();
        }

        function updateSelectedCount() {
            const totalCustom = customTasks.length;
            const totalSelected = selectedTasks.size + totalCustom;
            showStatus(`✨ נבחרו ${totalSelected} משימות להוספה (${selectedTasks.size} קיימות + ${totalCustom} חדשות)`, 'success');
        }

        function addCustomTask() {
            const title = document.getElementById('newTaskTitle').value;
            const description = document.getElementById('newTaskDescription').value;
            const type = document.getElementById('newTaskType').value;
            const priority = document.getElementById('newTaskPriority').value;
            const deadline = document.getElementById('newTaskDeadline').value;
            const notes = document.getElementById('newTaskNotes').value;

            if (!title.trim()) {
                showStatus('❌ נדרשת כותרת למשימה', 'error');
                return;
            }

            const customTask = {
                title: title,
                description: description || title,
                type: type,
                priority: priority,
                deadline: deadline,
                notes: notes,
                status: 'pending',
                isCustom: true
            };

            customTasks.push(customTask);
            displayCustomTasks();
            clearCustomTask();
            updateSelectedCount();
        }

        function displayCustomTasks() {
            const container = document.getElementById('customTasksList');
            container.innerHTML = '';
            
            customTasks.forEach((task, index) => {
                const taskDiv = document.createElement('div');
                taskDiv.className = 'task selected';
                taskDiv.innerHTML = `
                    <div class="task-content">
                        <h3>🆕 ${task.title}</h3>
                        <p><strong>תיאור:</strong> ${task.description}</p>
                        <p><strong>סוג:</strong> ${getTypeLabel(task.type)}</p>
                        <p><strong>עדיפות:</strong> ${getPriorityLabel(task.priority)}</p>
                        ${task.deadline ? `<p><strong>דד-ליין:</strong> ${task.deadline}</p>` : ''}
                        ${task.notes ? `<p><strong>הערות:</strong> ${task.notes}</p>` : ''}
                        <button class="btn-danger" onclick="removeCustomTask(${index})" style="margin-top: 10px;">🗑️ הסר משימה</button>
                    </div>
                `;
                container.appendChild(taskDiv);
            });
        }

        function removeCustomTask(index) {
            customTasks.splice(index, 1);
            displayCustomTasks();
            updateSelectedCount();
        }

        function getTypeLabel(type) {
            const labels = {
                'academic': '📚 אקדמי',
                'debts': '💰 חובות',
                'bureaucracy': '🏢 בירוקרטיה'
            };
            return labels[type] || type;
        }

        function getPriorityLabel(priority) {
            const labels = {
                'high': '🔥 גבוהה',
                'medium': '📅 בינונית',
                'low': '⚡ נמוכה'
            };
            return labels[priority] || priority;
        }

        function clearCustomTask() {
            document.getElementById('newTaskTitle').value = '';
            document.getElementById('newTaskDescription').value = '';
            document.getElementById('newTaskType').value = 'academic';
            document.getElementById('newTaskPriority').value = 'medium';
            document.getElementById('newTaskDeadline').value = '';
            document.getElementById('newTaskNotes').value = '';
        }

        function clearAll() {
            deselectAll();
            customTasks = [];
            displayCustomTasks();
            clearCustomTask();
            showStatus('🗑️ נוקה הכל', 'success');
        }

        function showStatus(message, type = 'loading') {
            const status = document.getElementById('status');
            status.innerHTML = message;
            status.className = type;
        }

        async function addSelectedTasks() {
            const tasksToAdd = [];
            
            // Add selected predefined tasks
            selectedTasks.forEach(taskId => {
                if (taskId < tasks.length) {
                    const task = { ...tasks[taskId] };
                    // Get user notes from textarea
                    const textarea = document.querySelector(`[data-task-id="${taskId}"] textarea`);
                    if (textarea && textarea.value.trim()) {
                        task.notes = (task.notes || '') + '\n\nהערות נוספות: ' + textarea.value.trim();
                    }
                    tasksToAdd.push(task);
                }
            });
            
            // Add custom tasks
            customTasks.forEach(task => {
                tasksToAdd.push(task);
            });

            if (tasksToAdd.length === 0) {
                showStatus('❌ לא נבחרו משימות להוספה', 'error');
                return;
            }

            showStatus(`⏳ מוסיף ${tasksToAdd.length} משימות למערכת...`, 'loading');
            
            try {
                const response = await fetch('/api/tasks/bulk', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ tasks: tasksToAdd })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (result.success) {
                    showStatus(`✅ הצלחה! ${result.created} משימות נוספו למערכת`, 'success');
                    setTimeout(() => {
                        window.location.href = '/';
                    }, 2000);
                } else {
                    showStatus(`❌ שגיאה: ${result.error}`, 'error');
                }
            } catch (error) {
                showStatus(`❌ שגיאה בחיבור: ${error.message}`, 'error');
            }
        }

        // Initialize - select all by default
        window.onload = () => {
            selectAll();
        };
    </script>
</body>
</html>