<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
  <!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>עוזרת AI אישית - מיכל</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="modal-styles.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <h1>מערכת מיכל AI - מעודכנת!</h1>
                <div class="header-info">
                    <span class="status-indicator active">🟢 מחובר</span>
                    <span class="user-info">👋 שלום מיכל!</span>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="app-nav">
            <div class="nav-tabs">
                <button class="nav-tab active" data-tab="smart-overview">🤖 סקירה חכמה</button>
                <button class="nav-tab" data-tab="tasks">📝 משימות</button>
                <button class="nav-tab" data-tab="debts">💰 חובות</button>
                <button class="nav-tab" data-tab="bureaucracy">🏛️ ביורוקרטיה</button>
                <button class="nav-tab" data-tab="connector-status">🔗 מחברים</button>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="app-main">
            <div class="main-content">
                <!-- Left Side - Dashboard -->
                <div class="dashboard-section">
                    <div class="tab-content">
                        <!-- Smart Overview Tab -->
                        <div id="smart-overview-tab" class="tab-panel active">
                            <h2>🤖 סקירה חכמה</h2>
                            
                            <!-- Management Actions -->
                            <div class="management-actions">
                                <h4>🎛️ פעולות ניהול</h4>
                                <button class="mgmt-btn primary" onclick="openSmartChatModal()">
                                    💬 צ'אט חכם עם המערכת
                                </button>
                                <button class="mgmt-btn info" onclick="openDocumentUploadModal()">
                                    📄 העלה מסמכים
                                </button>
                                <button class="mgmt-btn success" onclick="addBulkTasks()">
                                    ✅ הוסף משימות בחברות
                                </button>
                                <button class="mgmt-btn danger" onclick="clearAll()">
                                    🗑️ נקה הכל
                                </button>
                                <button class="mgmt-btn secondary" onclick="selectAll()">
                                    ☑️ בחר הכל / בטל הכל
                                </button>
                            </div>

                            <!-- Smart Stats -->
                            <div class="smart-stats">
                                <div class="smart-stat critical">
                                    <div class="stat-icon">🚨</div>
                                    <div class="stat-info">
                                        <div class="stat-number" id="criticalCount">0</div>
                                        <div class="stat-label">קריטי היום</div>
                                    </div>
                                </div>

                                <div class="smart-stat urgent">
                                    <div class="stat-icon">⏰</div>
                                    <div class="stat-info">
                                        <div class="stat-number" id="urgentCount">0</div>
                                        <div class="stat-label">דחוף השבוע</div>
                                    </div>
                                </div>

                                <div class="smart-stat normal">
                                    <div class="stat-icon">📋</div>
                                    <div class="stat-info">
                                        <div class="stat-number" id="totalCount">0</div>
                                        <div class="stat-label">סה"כ פעילים</div>
                                    </div>
                                </div>

                                <div class="smart-stat success">
                                    <div class="stat-icon">✅</div>
                                    <div class="stat-info">
                                        <div class="stat-number" id="completedCount">0</div>
                                        <div class="stat-label">הושלמו השבוע</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Sync Status -->
                            <div class="sync-status">
                                <h4>📊 מצב הסנכרונים</h4>
                                <div class="sync-items">
                                    <div class="sync-item">
                                        📧 מיילים <span class="sync-badge" id="emailsBadge">0</span>
                                    </div>
                                    <div class="sync-item">
                                        📚 אקדמיה <span class="sync-badge" id="academicBadge">0</span>
                                    </div>
                                    <div class="sync-item">
                                        🏛️ ביורוקרטיה <span class="sync-badge" id="bureaucracyBadge">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Tasks Tab -->
                        <div id="tasks-tab" class="tab-panel active">
                            <h2>📝 משימות פעילות</h2>
                            <div class="table-container">
                                <table class="tasks-table">
                                    <thead>
                                        <tr>
                                            <th>פעולה</th>
                                            <th>דחיפות</th>
                                            <th>זמן</th>
                                            <th>תיאור</th>
                                            <th>כותרת</th>
                                            <th>סוג</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tasksTableBody">
                                        <!-- Tasks will be inserted here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- Debts Tab -->
                        <div id="debts-tab" class="tab-panel">
                            <h2>💰 חובות ותשלומים</h2>
                            <div class="table-container">
                                <table class="debts-table">
                                    <thead>
                                        <tr>
                                            <th>פעולות</th>
                                            <th>סטטוס</th>
                                            <th>סכום</th>
                                            <th>תאריך יעד</th>
                                            <th>נושה</th>
                                            <th>תיאור</th>
                                        </tr>
                                    </thead>
                                    <tbody id="debtsTableBody">
                                        <!-- Debts will be inserted here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- Bureaucracy Tab -->
                        <div id="bureaucracy-tab" class="tab-panel">
                            <h2>🏛️ ביורוקרטיה וממשל</h2>
                            <div class="table-container">
                                <table class="bureaucracy-table">
                                    <thead>
                                        <tr>
                                            <th>פעולות</th>
                                            <th>דחיפות</th>
                                            <th>מוסד</th>
                                            <th>תאריך יעד</th>
                                            <th>תיאור</th>
                                            <th>נושא</th>
                                        </tr>
                                    </thead>
                                    <tbody id="bureaucracyTableBody">
                                        <!-- Bureaucracy items will be inserted here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Smart Overview Tab -->
                        <div id="smart-overview-tab" class="tab-panel">
                            <h2>🤖 סקירה חכמה</h2>
                            
                            <!-- Quick Actions -->
                            <div class="quick-actions-panel">
                                <h4>פעולות מהירות</h4>
                                <div class="quick-actions-grid">
                                    <button id="gmailSyncBtn" class="action-btn secondary">📨 סנכרון מיילים</button>
                                    <button id="driveUploadBtn" class="action-btn primary">📄 העלה מסמכים</button>
                                    <button id="quickTaskBtn" class="action-btn success">➕ משימה מהירה</button>
                                    <button id="aiChatBtn" class="action-btn info">💬 צ'אט AI</button>
                                </div>
                            </div>
                            
                            <!-- Email Thread Preview -->
                            <div class="email-thread-preview">
                                <div class="etp-header">
                                    <span class="etp-title">תכתובת מיילים</span>
                                    <button class="etp-refresh" onclick="loadEmailThread()">🔄</button>
                                </div>
                                <div class="etp-body" id="emailThreadBody">(בחרי פריט עם מיילים)</div>
                            </div>
                            
                            <!-- Budget Calculator -->
                            <div class="budget-calculator">
                                <div class="bc-header">
                                    <h4>🧮 מחשבון תקציב</h4>
                                </div>
                                <div class="bc-body">
                                    <label>יתרה נוכחית:</label>
                                    <input type="number" id="balanceInput" placeholder="2000" style="width:120px;" />
                                    <span>₪</span>
                                    <button onclick="calculateBudget()" class="small-btn">חשב</button>
                                    <div id="budgetResult" class="budget-result"></div>
                                </div>
                            </div>
                            
                            <!-- Priorities Table -->
                            <div class="table-container priorities-table-wrapper">
                                <h4>🎯 סדר עדיפויות מותאם אישית</h4>
                                <table class="priorities-table" id="prioritiesTable">
                                    <thead>
                                        <tr>
                                            <th>פעולות</th>
                                            <th>ציון</th>
                                            <th>זמן נותר</th>
                                            <th>סוג</th>
                                            <th>תיאור</th>
                                            <th>משימה</th>
                                        </tr>
                                    </thead>
                                    <tbody id="prioritiesTableBody">
                                        <!-- Priorities will be dynamically inserted here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- Connector Status Tab -->
                        <div id="connector-status-tab" class="tab-panel">
                            <h2>🔗 מצב מחברים</h2>
                            <div class="connectors-grid">
                                <div class="connector-card gmail-connector">
                                    <div class="connector-header">
                                        <div class="connector-icon">📧</div>
                                        <div class="connector-info">
                                            <h3 class="connector-title">Gmail</h3>
                                            <p class="connector-subtitle">סנכרון מיילים ותכתובות</p>
                                        </div>
                                        <div class="connector-status" id="gmailConnectorStatus">
                                            <span class="status-indicator checking">בודק...</span>
                                        </div>
                                    </div>
                                    <div class="connector-actions">
                                        <button class="connector-btn sync-btn" onclick="syncGmailAndRefresh()">
                                            🔄 סנכרן מיילים
                                        </button>
                                        <button class="connector-btn config-btn" onclick="configureGmail()">
                                            ⚙️ הגדרות
                                        </button>
                                    </div>
                                    <div class="connector-stats">
                                        <div class="stat">
                                            <span class="stat-label">מיילים חדשים:</span>
                                            <span class="stat-value" id="newEmailsCount">0</span>
                                        </div>
                                        <div class="stat">
                                            <span class="stat-label">סנכרון אחרון:</span>
                                            <span class="stat-value" id="lastSyncTime">אף פעם</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Side - Chat -->
                <div class="chat-section">
                    <div class="chat-header">
                        <h3>💬 צ'אט עם העוזרת</h3>
                        <div class="chat-controls">
                            <button id="clearChatBtn" class="small-btn secondary">🗑️</button>
                            <button id="voiceBtn" class="small-btn primary">🎤</button>
                        </div>
                    </div>
                    <div class="chat-messages" id="chatMessages">
                        <div class="message bot-message">
                            <div class="message-avatar">🤖</div>
                            <div class="message-content">
                                <p>שלום מיכל! אני כאן לעזור לך לנהל את המשימות, החובות והתכתובות שלך. איך אוכל לעזור?</p>
                            </div>
                        </div>
                    </div>
                    <div class="chat-input-container">
                        <div class="chat-input-wrapper">
                            <textarea id="chatInput" placeholder="כתבי כאן את ההודעה שלך..." rows="3"></textarea>
                            <button id="sendBtn" class="send-btn">שלח</button>
                        </div>
                        <div class="quick-suggestions" id="quickSuggestions">
                            <button class="suggestion-btn" onclick="addQuickSuggestion('הוסף משימה חדשה')">➕ הוסף משימה</button>
                            <button class="suggestion-btn" onclick="addQuickSuggestion('מה המשימות הדחופות שלי?')">⏰ משימות דחופות</button>
                            <button class="suggestion-btn" onclick="addQuickSuggestion('סכם לי את החובות')">💰 סיכום חובות</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Task Input Modal -->
    <div id="taskModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>➕ הוספת משימה חדשה</h3>
                <button class="modal-close" onclick="closeTaskModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="taskForm">
                    <div class="form-group">
                        <label for="taskType">סוג המשימה:</label>
                        <select id="taskType" required>
                            <option value="">בחר סוג...</option>
                            <option value="tasks">משימה כללית</option>
                            <option value="debts">חוב/תשלום</option>
                            <option value="bureaucracy">ביורוקרטיה</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="taskTitle">כותרת:</label>
                        <input type="text" id="taskTitle" required placeholder="תאר את המשימה בקצרה...">
                    </div>
                    
                    <div class="form-group">
                        <label for="taskDescription">תיאור מפורט:</label>
                        <textarea id="taskDescription" rows="3" placeholder="פרטים נוספים על המשימה..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="taskPriority">רמת חשיבות:</label>
                        <select id="taskPriority">
                            <option value="low">נמוכה</option>
                            <option value="medium" selected>בינונית</option>
                            <option value="high">גבוהה</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="taskDueDate">תאריך יעד:</label>
                        <input type="date" id="taskDueDate">
                    </div>
                    
                    <!-- Dynamic fields based on task type -->
                    <div id="debtFields" class="conditional-fields" style="display: none;">
                        <div class="form-group">
                            <label for="debtAmount">סכום:</label>
                            <input type="number" id="debtAmount" placeholder="0">
                        </div>
                        <div class="form-group">
                            <label for="creditorName">שם הנושה:</label>
                            <input type="text" id="creditorName" placeholder="שם החברה או הגוף">
                        </div>
                    </div>
                    
                    <div id="bureaucracyFields" class="conditional-fields" style="display: none;">
                        <div class="form-group">
                            <label for="institution">מוסד:</label>
                            <input type="text" id="institution" placeholder="משרד הפנים, ביטוח לאומי וכו'">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn--secondary" onclick="closeTaskModal()">ביטול</button>
                <button type="button" class="btn btn--primary" onclick="saveTask()">שמור משימה</button>
            </div>
        </div>
    </div>

    <!-- Email Preview Modal -->
    <div id="emailModal" class="modal" style="display: none;">
        <div class="modal-content email-modal">
            <div class="modal-header">
                <h3 id="emailSubject">מייל</h3>
                <button class="modal-close" onclick="closeEmailModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="email-info">
                    <p><strong>מאת:</strong> <span id="emailFrom"></span></p>
                    <p><strong>תאריך:</strong> <span id="emailDate"></span></p>
                </div>
                <div class="email-content" id="emailContent"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn--secondary" onclick="closeEmailModal()">סגור</button>
                <button class="btn btn--primary" onclick="replyToEmail()">השב</button>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <!-- Gmail Sync Approval Modal -->
    <div id="gmailSyncModal" class="modal" style="display: none;">
        <div class="modal-content sync-approval-modal">
            <div class="modal-header">
                <h3>🤖 AI מצא עדכונים חדשים במיילים</h3>
                <button class="modal-close" onclick="closeGmailSyncModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="foundEmailsContainer">
                    <!-- Dynamic content will be added here -->
                </div>
                <div class="sync-options">
                    <h4>⚙️ הגדרות סנכרון:</h4>
                    <div class="sync-settings">
                        <div class="setting-group">
                            <label>
                                <input type="checkbox" id="autoCreateTasks" checked>
                                צור משימות אוטומטית ממיילים חשובים
                            </label>
                        </div>
                        <div class="setting-group">
                            <label>
                                <input type="checkbox" id="smartFilter" checked>
                                פלטר חכם - רק מיילים רלוונטיים
                            </label>
                        </div>
                        <div class="setting-group">
                            <label for="syncTimeRange">טווח זמן לסנכרון:</label>
                            <select id="syncTimeRange">
                                <option value="1">יום אחד אחרון</option>
                                <option value="3" selected>3 ימים אחרונים</option>
                                <option value="7">שבוע אחרון</option>
                                <option value="30">חודש אחרון</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn--secondary" onclick="closeGmailSyncModal()">ביטול</button>
                <button class="btn btn--primary" id="approveGmailSync">✅ אשר עדכונים</button>
                <button class="btn btn--success" id="syncAndLearn">🧠 אשר ולמד מהבחירות</button>
            </div>
        </div>
    </div>

    <!-- Smart Chat Modal -->
    <div id="smartChatModal" class="modal" style="display: none;">
        <div class="modal-content chat-modal">
            <div class="modal-header">
                <h3>💬 צ'אט עם המערכת</h3>
                <button class="modal-close" onclick="closeSmartChatModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="chat-container">
                    <div id="smartChatMessages" class="smart-chat-messages">
                        <div class="chat-message ai-message">
                            <div class="message-avatar">🤖</div>
                            <div class="message-content">
                                <p>שלום מיכל! אני יכול לעזור לך עם:</p>
                                <ul>
                                    <li>🔄 עדכון קוד המערכת</li>
                                    <li>⚙️ שינוי הגדרות הסוכן</li>
                                    <li>🎯 יצירת כללי סינון חדשים</li>
                                    <li>📝 כתיבת טיוטות מיילים</li>
                                    <li>🧠 למידה מהפידבק שלך</li>
                                </ul>
                                <p>מה את רוצה לשנות או לשפר?</p>
                            </div>
                        </div>
                    </div>
                    <div class="chat-input-container">
                        <div class="quick-actions">
                            <button class="quick-action-btn" onclick="addQuickMessage('שנה את צבע המערכת לורוד-ירוק')">🎨 שנה עיצוב</button>
                            <button class="quick-action-btn" onclick="addQuickMessage('הוסף כלל סינון למיילי PAIR Finance')">⚙️ הוסף כלל</button>
                            <button class="quick-action-btn" onclick="addQuickMessage('כתוב טיוטה להתנגדות לחוב')">✍️ כתוב טיוטה</button>
                            <button class="quick-action-btn" onclick="addQuickMessage('למד מהאישורים שלי היום')">🧠 למידה</button>
                        </div>
                        <div class="chat-input-area">
                            <textarea id="smartChatInput" placeholder="תאר מה את רוצה לשנות או לשפר במערכת..." rows="3"></textarea>
                            <button id="sendSmartChatBtn" class="btn btn--primary">שלח</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Document Upload Modal -->
    <div id="documentUploadModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>📄 העלאת מסמכים ל-Google Drive</h3>
                <button class="modal-close" onclick="closeDocumentUploadModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">📤</div>
                    <h4>גרור מסמכים לכאן או לחץ לבחירה</h4>
                    <p>תמיכה ב-PDF, DOC, DOCX, JPG, PNG (עד 10MB כל קובץ)</p>
                    <input type="file" id="documentInput" multiple accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" style="display: none;">
                    <button class="btn btn--secondary" onclick="document.getElementById('documentInput').click()">
                        📂 בחר קבצים
                    </button>
                </div>
                <div id="uploadProgress" style="display: none;">
                    <h4>מעלה מסמכים...</h4>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div id="uploadStatus">מכין קבצים...</div>
                </div>
                <div id="uploadResults" style="display: none;">
                    <h4>תוצאות העלאה:</h4>
                    <div id="resultsContainer"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn--secondary" onclick="closeDocumentUploadModal()">סגור</button>
                <button class="btn btn--primary" id="startUploadBtn" onclick="startDocumentUpload()" style="display: none;">
                    🚀 התחל העלאה
                </button>
            </div>
        </div>
    </div>

    <!-- Added version query to bust cache so שהקובץ המעודכן ייטען -->
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <h1>מערכת מיכל AI - מעודכנת!</h1>
                <div class="header-info">
                    <span class="current-date">רביעי, 26 בספטמבר 2025</span>
                    <span class="user-name">שלום מיכל 👋 [UPDATED]</span>
                </div>
            </div>
        </header>

        <main class="app-main">
            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card urgent">
                    <div class="stat-number">4</div>
                    <div class="stat-label">משימות דחופות</div>
                </div>
                <div class="stat-card today">
                    <div class="stat-number">3</div>
                    <div class="stat-label">פעולות היום</div>
                </div>
                <div class="stat-card revenue">
                    <div class="stat-number">₪8,150</div>
                    <div class="stat-label">הכנסות צפויות</div>
                </div>
                <div class="stat-card debts">
                    <div class="stat-number">5</div>
                    <div class="stat-label">חובות פעילים</div>
                </div>
            </div>

            <div class="main-content">
                <!-- Left Side - Dashboard -->
                <div class="dashboard-section">
                    <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="nav-tab active" data-tab="smart-overview">🧠 סקירה חכמה</button>
            <button class="nav-tab" data-tab="academic">📚 אקדמיה</button>
            <button class="nav-tab" data-tab="debts">💰 חובות</button>
            <button class="nav-tab" data-tab="bureaucracy">🏛️ בירוקרטיה</button>
            <button class="nav-tab" data-tab="priorities">⚖️ תעדוף</button>
            <button class="nav-tab" data-tab="connectors">🔌 חיבורים</button>
            <button class="nav-tab" data-tab="overview">📊 סיכום</button>
        </div>                    <!-- Tab Contents -->
                    <div class="tab-content">
                        <!-- Smart Overview Tab - טאב הסקירה החכמה -->
                        <div id="smart-overview" class="tab-panel active">
                            <div class="page-header">
                                <div>
                                    <h2>🧠 סקירה חכמה - כל המשימות לפי עדיפות AI</h2>
                                    <div id="systemStatusIndicator" class="system-status">
                                        <span class="status-dot"></span>
                                        <span class="status-text">בודק מצב מערכת...</span>
                                    </div>
                                </div>
                                <div class="header-actions">
                                    <button class="action-btn primary" id="gmailQuickSyncBtn">
                                        📧 סנכרון מיילים
                                    </button>
                                    <button class="action-btn secondary" id="refreshSmartBtn">
                                        🔄 רענון חכם
                                    </button>
                                </div>
                            </div>

                            <!-- Management Actions -->
                            <div class="management-actions">
                                <button class="mgmt-btn primary" onclick="openSmartChatModal()">
                                    � צ'אט חכם עם המערכת
                                </button>
                                <button class="mgmt-btn success" onclick="addBulkTasks()">
                                    ✅ הוסף משימות בחברות
                                </button>
                                <button class="mgmt-btn danger" onclick="clearAll()">
                                    🗑️ נקה הכל
                                </button>
                                <button class="mgmt-btn secondary" onclick="selectAll()">
                                    ☑️ בחר הכל / בטל הכל
                                </button>
                            </div>

                            <!-- Smart Stats -->
                            <div class="smart-stats">
                                <div class="smart-stat critical">
                                    <div class="stat-icon">🚨</div>
                                    <div class="stat-info">
                                        <div class="stat-number" id="criticalCount">0</div>
                                        <div class="stat-label">קריטי היום</div>
                                    </div>
                                </div>
                                <div class="smart-stat urgent">
                                    <div class="stat-icon">⚡</div>
                                    <div class="stat-info">
                                        <div class="stat-number" id="urgentCount">0</div>
                                        <div class="stat-label">דחוף השבוע</div>
                                    </div>
                                </div>
                                <div class="smart-stat pending">
                                    <div class="stat-icon">📋</div>
                                    <div class="stat-info">
                                        <div class="stat-number" id="pendingCount">0</div>
                                        <div class="stat-label">ממתינות</div>
                                    </div>
                                </div>
                                <div class="smart-stat new-from-email">
                                    <div class="stat-icon">📨</div>
                                    <div class="stat-info">
                                        <div class="stat-number" id="emailTasksCount">0</div>
                                        <div class="stat-label">חדש ממייל</div>
                                    </div>
                                </div>
                            </div>
                            <div class="smart-last-updated">
                                <span>עודכן לאחרונה:</span>
                                <span id="smartOverviewUpdatedAt">—</span>
                            </div>

                            <!-- Sync Controls -->
                            <div class="sync-controls">
                                <h3>🔄 סנכרון נתונים</h3>
                                <div class="sync-buttons">
                                    <button class="sync-btn academic" id="syncAcademicBtn" data-module="academic">
                                        📚 אקדמיה <span class="sync-badge" id="academicBadge">0</span>
                                    </button>
                                    <button class="sync-btn bureaucracy" id="syncBureaucracyBtn" data-module="bureaucracy">
                                        🏛️ בירוקרטיה <span class="sync-badge" id="bureaucracyBadge">0</span>
                                    </button>
                                    <button class="sync-btn debts" id="syncDebtsBtn" data-module="debts">
                                        💰 חובות <span class="sync-badge" id="debtsBadge">0</span>
                                    </button>
                                    <button class="sync-btn emails" id="syncEmailBtn" data-module="emails">
                                        📧 מיילים <span class="sync-badge" id="emailsBadge">0</span>
                                    </button>
                                </div>
                            </div>

                            <!-- Additional Controls -->
                            <div class="additional-controls">
                                <button class="document-process-btn" id="processDocsBtn">📄 עבד מסמכים</button>
                                <button class="smart-recommendations-btn" id="smartRecBtn">🎯 המלצות חכמות</button>
                                <input type="file" id="documentUpload" accept=".pdf,.jpg,.jpeg,.png,.doc,.docx" style="display: none">
                                <button class="upload-document-btn" id="uploadDocBtn">📎 העלה מסמך</button>
                            </div>

                            <!-- Smart Recommendations Panel -->
                            <div id="recommendations-panel" class="recommendations-panel" style="display: none;">
                                <h3>🎯 המלצות חכמות</h3>
                                <div id="recommendationsContainer"></div>
                            </div>

                            <!-- Smart Table -->
                            <div class="table-container">
                                <table class="tasks-table" id="smartTable">
                                    <thead>
                                        <tr>
                                            <th>🎯 עדיפות AI</th>
                                            <th>📝 משימה</th>
                                            <th>🏷️ תחום</th>
                                            <th>👤 גורם</th>
                                            <th>📅 דדליין</th>
                                            <th>⏰ זמן נותר</th>
                                            <th>🔥 דחיפות</th>
                                            <th>⚡ פעולה</th>
                                        </tr>
                                    </thead>
                                    <tbody id="smartTableBody">
                                        <!-- יתמלא באופן דינמי -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Academic Tasks Tab -->
                        <div id="academic" class="tab-panel">
                            <div class="tab-header">
                                <h2>משימות אקדמיות</h2>
                                <button class="add-task-btn" onclick="openTaskModal('academic')">
                                    <i class="icon">➕</i> הוסף משימה אקדמית
                                </button>
                            </div>
                            <div class="table-container">
                                <table class="tasks-table" id="academicTable">
                                    <thead>
                                        <tr>
                                            <th>פרויקט</th>
                                            <th>לקוח</th>
                                            <th>מועד</th>
                                            <th>סטטוס</th>
                                            <th>דחיפות</th>
                                            <th>פעולה נדרשת</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Academic tasks will be populated by JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Bureaucracy Tab -->
                        <div id="bureaucracy" class="tab-panel">
                            <div class="tab-header">
                                <h2>בירוקרטיה גרמנית וישראלית</h2>
                                <button class="add-task-btn" onclick="openTaskModal('bureaucracy')">
                                    <i class="icon">➕</i> הוסף משימה בירוקרטית
                                </button>
                            </div>
                            <div class="table-container">
                                <table class="tasks-table" id="bureaucracyTable">
                                    <thead>
                                        <tr>
                                            <th>משימה</th>
                                            <th>רשות</th>
                                            <th>מועד</th>
                                            <th>סטטוס</th>
                                            <th>דחיפות</th>
                                            <th>פעולה נדרשת</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Bureaucracy tasks will be populated by JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Debts Tab -->
                        <div id="debts" class="tab-panel">
                            <div class="tab-header">
                                <h2>ניהול חובות וגביה</h2>
                                <button class="add-task-btn" onclick="openTaskModal('debts')">
                                    <i class="icon">➕</i> הוסף חוב חדש
                                </button>
                            </div>
                            <div class="table-container">
                                <table class="debts-table" id="debtsTable">
                                    <thead>
                                        <tr>
                                            <th>נושה</th>
                                            <th>חברה</th>
                                            <th>סכום</th>
                                            <th>מספר תיק</th>
                                            <th>סטטוס</th>
                                            <th>מועד</th>
                                            <th>פעולה נדרשת</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Debts will be populated by JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Overview Tab -->
                        <div id="overview" class="tab-panel">
                            <h2>סקירה כללית</h2>
                            <div class="overview-grid">
                                <div class="overview-section">
                                    <h3>דחוף היום</h3>
                                    <div id="urgentToday" class="urgent-list">
                                        <!-- Will be populated by JS -->
                                    </div>
                                </div>
                                <div class="overview-section">
                                    <h3>השבוע הקרוב</h3>
                                    <div id="thisWeek" class="week-list">
                                        <!-- Will be populated by JS -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Priorities Tab -->
                        <div id="priorities" class="tab-panel">
                            <h2>תעדוף חכם (AgentCore)</h2>
                            <div class="priorities-toolbar">
                                <button id="refreshPrioritiesBtn" class="action-btn secondary">🔄 רענון תעדוף</button>
                                <button id="runSyncSimBtn" class="action-btn secondary">🛰️ סימולציית סנכרון</button>
                                <button id="loadQuestionsBtn" class="action-btn secondary">❓ שאלות פתוחות (<span id="questionsCount">0</span>)</button>
                                <button id="gmailSyncBtn" class="action-btn secondary">📨 סנכרון מיילים</button>
                                <button id="autoActionsBtn" class="action-btn secondary">🤖 פעולות חכמות</button>
                                <div class="balance-input-group">
                                    <label for="balanceInput">יתרה בחשבון:</label>
                                    <input type="number" id="balanceInput" placeholder="2000" style="width:120px;" />
                                    <button id="updateBalanceBtn" class="action-btn primary small">עדכון</button>
                                </div>
                            </div>
                            <div id="questionsPanel" class="questions-panel" style="display:none"></div>
                            <div id="autoActionsPanel" class="questions-panel" style="display:none"></div>
                            <div id="emailThreadPanel" class="email-thread-panel" style="display:none">
                                <div class="etp-header">
                                    <span class="etp-title">תכתובת מיילים</span>
                                    <button class="close-etp" id="closeEmailThreadBtn">✖</button>
                                </div>
                                <div class="etp-body" id="emailThreadBody">(בחרי פריט עם מיילים)</div>
                            </div>
                            <div class="table-container priorities-table-wrapper">
                                <table class="priorities-table" id="prioritiesTable">
                                    <thead>
                                        <tr>
                                            <th>משימה / פריט</th>
                                            <th>דדליין</th>
                                            <th>סכום</th>
                                            <th>סטטוס</th>
                                            <th>תכתובת</th>
                                            <th>AI ציון</th>
                                            <th>פעולה הבאה</th>
                                        </tr>
                                    </thead>
                                    <tbody id="prioritiesTableBody">
                                        <tr><td colspan="7" style="text-align:center;padding:20px;">טוען תעדוף...</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Connectors Tab -->
                        <div id="connectors" class="tab-panel">
                            <h2>חיבורים ושירותים</h2>
                            <div class="connectors-grid">
                                <section class="connector-card">
                                    <div class="connector-header">
                                        <div>
                                            <h3>📧 Gmail</h3>
                                            <p class="connector-subtitle">סנכרון מיילים ותכתובות</p>
                                        </div>
                                        <span id="gmailStatusBadge" class="status-chip offline">מנותק</span>
                                    </div>
                                    <div class="connector-body">
                                        <p class="connector-info" id="gmailStatusInfo">בודק סטטוס...</p>
                                        <div class="accounts-list" id="gmailAccountsList"></div>
                                        <div class="connector-actions">
                                            <button id="gmailConnectBtn" class="action-btn primary">🔗 התחברות</button>
                                            <button id="gmailRefreshBtn" class="action-btn secondary">🔄 בדיקת סטטוס</button>
                                        </div>
                                    </div>
                                </section>
                                <section class="connector-card disabled">
                                    <div class="connector-header">
                                        <div>
                                            <h3>📂 Google Drive</h3>
                                            <p class="connector-subtitle">בקרוב: מסמכים וקבצים</p>
                                        </div>
                                        <span class="status-chip offline">בקרוב</span>
                                    </div>
                                </section>
                                <section class="connector-card disabled">
                                    <div class="connector-header">
                                        <div>
                                            <h3>💬 WhatsApp</h3>
                                            <p class="connector-subtitle">בקרוב: סנכרון שיחות</p>
                                        </div>
                                        <span class="status-chip offline">בקרוב</span>
                                    </div>
                                </section>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Side - Chat Interface -->
                <div class="chat-section">
                    <div class="chat-header">
                        <h3>עוזרת AI</h3>
                        <div class="chat-status">
                            <div class="status-indicator online"></div>
                            <span>מחוברת</span>
                        </div>
                    </div>

                    <!-- Quick Questions -->
                    <div class="quick-questions">
                        <h4>שאלות מהירות:</h4>
                        <div class="quick-question-buttons">
                            <button class="quick-btn" data-question="מה דחוף היום?">מה דחוף היום?</button>
                            <button class="quick-btn" data-question="איך אני עונה ל-PAIR Finance?">איך עונים ל-PAIR Finance?</button>
                            <button class="quick-btn" data-question="מה המצב עם הבירוקרטיה?">מצב הבירוקרטיה</button>
                            <button class="quick-btn" data-question="הכן טיוטת מייל">הכנת טיוטת מייל</button>
                        </div>
                    </div>

                    <!-- Chat Messages -->
                    <div class="chat-messages" id="chatMessages">
                        <div class="message ai-message">
                            <div class="message-content">
                                שלום מיכל! יש לך כמה משימות דחופות היום - הסמינריון של כרמית וההתנגדות ל-PAIR Finance. איך אני יכולה לעזור?
                            </div>
                            <div class="message-time">18:00</div>
                        </div>
                    </div>

                    <!-- Chat Input -->
                    <div class="chat-input-area">
                        <div class="file-upload-mini">
                            <input type="file" id="chatFileInput" class="hidden" multiple>
                            <button class="file-btn" id="fileUploadBtn">📎</button>
                        </div>
                        <div class="voice-input">
                            <button class="voice-btn" id="voiceBtn">🎤</button>
                        </div>
                        <div class="text-input">
                            <textarea id="chatInput" placeholder="הקלידי שאלה או בקשה..." rows="2"></textarea>
                            <button class="send-btn" id="sendBtn">שלח</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Action Modal -->
        <div id="actionModal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="actionModalTitle">פעולה נדרשת</h3>
                    <button class="modal-close" id="actionModalClose">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="actionModalContent">
                        <!-- Action content will be populated by JS -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn--secondary" id="actionModalCancel">ביטול</button>
                    <button class="btn btn--primary" id="actionModalSave">בצע פעולה</button>
                </div>
            </div>
        </div>

        <!-- Email Draft Modal -->
        <div id="emailModal" class="modal hidden">
            <div class="modal-content email-modal">
                <div class="modal-header">
                    <h3 id="emailModalTitle">טיוטת מייל/מכתב</h3>
                    <button class="modal-close" id="emailModalClose">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-label">נושא:</label>
                        <input type="text" class="form-control" id="emailSubject">
                    </div>
                    <div class="form-group">
                        <label class="form-label">תוכן המכתב:</label>
                        <textarea class="form-control" id="emailContent" rows="10"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">קבצים מצורפים נדרשים:</label>
                        <div id="requiredAttachments" class="attachments-list">
                            <!-- Will be populated by JS -->
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">הצעדים הבאים:</label>
                        <div id="nextSteps" class="next-steps-list">
                            <!-- Will be populated by JS -->
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn--secondary" id="emailModalCancel">ביטול</button>
                    <button class="btn btn--primary" id="emailModalCopy">העתק לטקסט</button>
                    <button class="btn btn--primary" id="emailModalSend">שלח מייל</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Sync Updates Modal -->
    <div id="syncModal" class="sync-modal">
        <div class="sync-modal-content">
            <div class="sync-modal-header">
                <h3 id="syncModalTitle" class="sync-modal-title">עדכונים ממתינים</h3>
                <button class="sync-modal-close" id="syncModalClose">&times;</button>
            </div>
            <div id="syncModalBody" class="sync-modal-body">
                <div class="sync-loading">
                    <div class="spinner"></div>
                    <p>טוען עדכונים...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Task Input Modal -->
    <div id="taskModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="taskModalTitle">הוסף משימה חדשה</h3>
                <button class="modal-close" onclick="closeTaskModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="taskForm">
                    <div class="form-group">
                        <label for="taskTitle">כותרת המשימה:</label>
                        <input type="text" id="taskTitle" name="title" required placeholder="למשל: הגשת עבודה סמסטריאלית">
                    </div>
                    
                    <div class="form-group">
                        <label for="taskDescription">תיאור מפורט:</label>
                        <textarea id="taskDescription" name="description" rows="4" placeholder="פרטים נוספים על המשימה..."></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="taskDueDate">תאריך יעד:</label>
                            <input type="date" id="taskDueDate" name="due_date">
                        </div>
                        
                        <div class="form-group">
                            <label for="taskPriority">דחיפות:</label>
                            <select id="taskPriority" name="priority">
                                <option value="low">נמוכה</option>
                                <option value="medium" selected>בינונית</option>
                                <option value="high">גבוהה</option>
                                <option value="urgent">דחוף</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="taskStatus">סטטוס:</label>
                            <select id="taskStatus" name="status">
                                <option value="pending">ממתין</option>
                                <option value="in_progress">בביצוע</option>
                                <option value="waiting_response">ממתין לתגובה</option>
                                <option value="completed">הושלם</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="taskClient">לקוח/גורם:</label>
                            <input type="text" id="taskClient" name="client" placeholder="שם הלקוח או הגורם">
                        </div>
                    </div>
                    
                    <!-- Fields specific to task type -->
                    <div id="academicFields" style="display: none;">
                        <div class="form-group">
                            <label for="taskCourse">קורס/מקצוע:</label>
                            <input type="text" id="taskCourse" name="course" placeholder="שם הקורס">
                        </div>
                    </div>
                    
                    <div id="bureaucracyFields" style="display: none;">
                        <div class="form-group">
                            <label for="taskAuthority">רשות:</label>
                            <input type="text" id="taskAuthority" name="authority" placeholder="למשל: משרד הפנים, בינלאומי">
                        </div>
                    </div>
                    
                    <div id="debtsFields" style="display: none;">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="taskAmount">סכום:</label>
                                <input type="number" id="taskAmount" name="amount" step="0.01" placeholder="0.00">
                            </div>
                            <div class="form-group">
                                <label for="taskCurrency">מטבע:</label>
                                <select id="taskCurrency" name="currency">
                                    <option value="EUR">יורו (EUR)</option>
                                    <option value="ILS">שקל (ILS)</option>
                                    <option value="USD">דולר (USD)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="taskNotes">הערות:</label>
                        <textarea id="taskNotes" name="notes" rows="3" placeholder="הערות נוספות..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn--secondary" onclick="closeTaskModal()">ביטול</button>
                <button type="button" class="btn btn--primary" onclick="saveTask()">שמור משימה</button>
            </div>
        </div>
    </div>

    <!-- Gmail Sync Approval Modal -->
    <div id="gmailSyncModal" class="modal" style="display: none;">
        <div class="modal-content sync-approval-modal">
            <div class="modal-header">
                <h3>🤖 AI מצא עדכונים חדשים במיילים</h3>
                <button class="modal-close" onclick="closeGmailSyncModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="foundEmailsContainer">
                    <!-- Dynamic content will be added here -->
                </div>
                <div class="sync-options">
                    <h4>⚙️ הגדרות סנכרון:</h4>
                    <div class="sync-settings">
                        <div class="setting-group">
                            <label>
                                <input type="checkbox" id="autoCreateTasks" checked>
                                צור משימות אוטומטית ממיילים חשובים
                            </label>
                        </div>
                        <div class="setting-group">
                            <label>
                                <input type="checkbox" id="smartFilter" checked>
                                פלטר חכם - רק מיילים רלוונטיים
                            </label>
                        </div>
                        <div class="setting-group">
                            <label for="syncTimeRange">טווח זמן לסנכרון:</label>
                            <select id="syncTimeRange">
                                <option value="1">יום אחד אחרון</option>
                                <option value="3" selected>3 ימים אחרונים</option>
                                <option value="7">שבוע אחרון</option>
                                <option value="30">חודש אחרון</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn--secondary" onclick="closeGmailSyncModal()">ביטול</button>
                <button class="btn btn--primary" id="approveGmailSync">✅ אשר עדכונים</button>
                <button class="btn btn--success" id="syncAndLearn">🧠 אשר ולמד מהבחירות</button>
            </div>
        </div>
    </div>

    <!-- Smart Chat Modal -->
        <!-- Smart Chat Modal -->
    <div id="smartChatModal" class="modal" style="display: none;">
        <div class="modal-content chat-modal">
            <div class="modal-header">
                <h3>💬 צ'אט עם המערכת</h3>
                <button class="modal-close" onclick="closeSmartChatModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="chat-container">
                    <div id="smartChatMessages" class="smart-chat-messages">
                        <div class="chat-message ai-message">
                            <div class="message-avatar">🤖</div>
                            <div class="message-content">
                                <p>שלום מיכל! אני יכול לעזור לך עם:</p>
                                <ul>
                                    <li>🔄 עדכון קוד המערכת</li>
                                    <li>⚙️ שינוי הגדרות הסוכן</li>
                                    <li>🎯 יצירת כללי סינון חדשים</li>
                                    <li>📝 כתיבת טיוטות מיילים</li>
                                    <li>🧠 למידה מהפידבק שלך</li>
                                </ul>
                                <p>מה את רוצה לשנות או לשפר?</p>
                            </div>
                        </div>
                    </div>
                    <div class="chat-input-container">
                        <div class="quick-actions">
                            <button class="quick-action-btn" onclick="addQuickMessage('שנה את צבע המערכת לורוד-ירוק')">🎨 שנה עיצוב</button>
                            <button class="quick-action-btn" onclick="addQuickMessage('הוסף כלל סינון למיילי PAIR Finance')">⚙️ הוסף כלל</button>
                            <button class="quick-action-btn" onclick="addQuickMessage('כתוב טיוטה להתנגדות לחוב')">✍️ כתוב טיוטה</button>
                            <button class="quick-action-btn" onclick="addQuickMessage('למד מהאישורים שלי היום')">🧠 למידה</button>
                        </div>
                        <div class="chat-input-area">
                            <textarea id="smartChatInput" placeholder="תאר מה את רוצה לשנות או לשפר במערכת..." rows="3"></textarea>
                            <button id="sendSmartChatBtn" class="btn btn--primary">שלח</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Document Upload Modal -->
    <div id="documentUploadModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>📄 העלאת מסמכים ל-Google Drive</h3>
                <button class="modal-close" onclick="closeDocumentUploadModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">📤</div>
                    <h4>גרור מסמכים לכאן או לחץ לבחירה</h4>
                    <p>תמיכה ב-PDF, DOC, DOCX, JPG, PNG (עד 10MB כל קובץ)</p>
                    <input type="file" id="documentInput" multiple accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" style="display: none;">
                    <button class="btn btn--secondary" onclick="document.getElementById('documentInput').click()">
                        📂 בחר קבצים
                    </button>
                </div>
                <div id="uploadProgress" style="display: none;">
                    <h4>מעלה מסמכים...</h4>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div id="uploadStatus">מכין קבצים...</div>
                </div>
                <div id="uploadResults" style="display: none;">
                    <h4>תוצאות העלאה:</h4>
                    <div id="resultsContainer"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn--secondary" onclick="closeDocumentUploadModal()">סגור</button>
                <button class="btn btn--primary" id="startUploadBtn" onclick="startDocumentUpload()" style="display: none;">
                    🚀 התחל העלאה
                </button>
            </div>
        </div>
    </div>

    <!-- Added version query to bust cache so שהקובץ המעודכן ייטען -->
    <script src="app.js?v=20250926-fixed"></script>
</body>
</html>